<script setup>
import { ref, reactive, inject, watch } from '@vue/runtime-core';
import { mapAttributes } from '../lib';

const props = defineProps({
  tile: {
    type: Object,
  },
});

const emit = defineEmits(['clickedTile']);
const isThreeClicked = inject('isThreeClicked');

const tileAttr = reactive(mapAttributes(props.tile));
tileAttr['opacity'] = 'opacity-100';

const clicked = ref(false);

const handleClick = () => {
  // Ensures the max number of clicked tiles is three
  if (!clicked.value && !isThreeClicked.value) {
    tileAttr.opacity = 'opacity-20 lg:hover:opacity-20';
    emit('clickedTile', {
      value: 1,
      idx: props.tile.idx,
    });
    clicked.value = !clicked.value;
  } else if (clicked.value) {
    tileAttr.opacity = 'opacity-100';
    emit('clickedTile', {
      value: -1,
      idx: props.tile.idx,
    });
    clicked.value = !clicked.value;
  }
};

const clearTiles = inject('clearTiles');

watch(clearTiles, (curr) => {
  if (curr) {
    clicked.value = false;
    tileAttr.opacity = 'opacity-100';
    setTimeout(() => (clearTiles.value = false), 100);
  }
});
</script>

<template>
  <div
    class="flex flex-col place-content-center lg:h-56 lg:w-56 lg:hover:opacity-50 lg:hover:cursor-pointer"
    :class="[tileAttr.bgColor, tileAttr.opacity]"
    @click="handleClick"
  >
    <div
      class="place-self-center"
      :class="[tileAttr.shapeColor, tileAttr.shape]"
    />
    <h1 class="place-self-center text-lg">{{ props.tile.idx }}</h1>
  </div>
</template>

<style></style>
